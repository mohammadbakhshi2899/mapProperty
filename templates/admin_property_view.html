<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ù„Ú© - {{ property.title }}</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        /* --- ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ â€” Ø­Ø°Ù Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ù…Ø´Ú©Ù„ layout --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(to right, #74ebd5, #ACB6E5);
            min-height: 220vh; /* Ø¨ÛŒØ´ØªØ± Ø§Ø² 100vh â€” Ø§Ø³Ú©Ø±ÙˆÙ„ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒÚ©Ù†Ù‡ */
            padding: 20px 20px 60px; /* ÙØ§ØµÙ„Ù‡ Ø®ÛŒÙ„ÛŒ Ø²ÛŒØ§Ø¯ Ø§Ø² Ø¨Ø§Ù„Ø§ */
            color: #333;
            line-height: 1.6;
        }

        .view-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
        }

        h2 {
            text-align: center;
            margin-bottom: 40px;
            color: #1a1a1a;
            font-size: 26px;
            font-weight: bold;
        }

        .section {
            margin-bottom: 35px;
            padding: 30px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background-color: #fafafa;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #2196F3;
            margin-bottom: 20px;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 8px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .info-item {
            display: flex;
            font-size: 16px;
        }

        .info-item strong {
            min-width: 160px;
            font-weight: bold;
            color: #2c3e50;
        }

        .amenities-list {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 10px;
        }

        .amenity-tag {
            background-color: #e3f2fd;
            color: #1565c0;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid #90caf9;
        }

        #map {
            height: 350px;
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            background-color: #f0f0f0;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1);
        }

        .back-btn {
            display: inline-block;
            margin-top: 30px;
            padding: 14px 24px;
            background-color: #9e9e9e;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
        }

        .back-btn:hover {
            background-color: #757575;
        }

        @media (max-width: 768px) {
            body {
                padding: 150px 15px 50px;
            }

            .view-container {
                padding: 25px;
            }

            h2 {
                font-size: 22px;
            }

            .info-grid {
                grid-template-columns: 1fr;
            }

            #map {
                height: 280px;
            }
        }
    </style>
</head>
<body>

<div class="view-container">
    <h2>ğŸ  {{ property.title }}</h2>

    <!-- Ù†Ù‚Ø´Ù‡ -->
    <div class="section">
        <div class="section-title">ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ù„Ú© Ø±ÙˆÛŒ Ù†Ù‚Ø´Ù‡</div>
        <div id="map"></div>
    </div>

    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù„Ú© -->
    <div class="section">
        <div class="section-title">ğŸ“Œ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù„Ú©</div>
        <div class="info-grid">
            <div class="info-item"><strong>Ù†ÙˆØ¹ Ù…Ù„Ú©:</strong> {{ property.property_type }}</div>
            <div class="info-item"><strong>Ù…ØªØ±Ø§Ú˜:</strong> {{ property.size }} Ù…ØªØ±</div>
            <div class="info-item"><strong>Ù‚ÛŒÙ…Øª Ú©Ù„:</strong> {{ "{:,}".format(property.price|int) }} ØªÙˆÙ…Ø§Ù†</div>
            <div class="info-item"><strong>Ù‚ÛŒÙ…Øª Ù‡Ø± Ù…ØªØ±:</strong> {{ "{:,}".format(property.pricePerMeter|int) }} ØªÙˆÙ…Ø§Ù†</div>
            <div class="info-item"><strong>ØªØ¹Ø¯Ø§Ø¯ Ø§ØªØ§Ù‚:</strong> {{ property.bedrooms or "â€”" }}</div>
            <div class="info-item"><strong>Ø³Ø§Ù„ Ø³Ø§Ø®Øª:</strong> {{ property.builtYear }}</div>
            <div class="info-item"><strong>Ø·Ø¨Ù‚Ù‡:</strong> {{ property.floorNumber }}</div>
            <div class="info-item"><strong>ÙˆØ¶Ø¹ÛŒØª Ù†Ù…Ø§:</strong> {{ property.facade_status }}</div>
            <div class="info-item"><strong>ØªØ¹Ø¯Ø§Ø¯ ÙˆØ§Ø­Ø¯:</strong> {{ property.units_in_building or "â€”" }}</div>
            <div class="info-item"><strong>Ø§Ø¨Ø¹Ø§Ø¯:</strong> {{ property.length }} Ã— {{ property.width }} Ù…ØªØ±</div>
            <div class="info-item"><strong>Ù…Ø­Ù„Ù‡:</strong> {{ property.neighborhood }}</div>
            <div class="info-item"><strong>Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚:</strong> {{ property.detailed_address }}</div>
            <div class="info-item"><strong>ÙˆØ¶Ø¹ÛŒØª:</strong> {{ "ÙØ¹Ø§Ù„" if property.status == "active" else "ØºÛŒØ±ÙØ¹Ø§Ù„" }}</div>
            <div class="info-item"><strong>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª (Ø´Ù…Ø³ÛŒ):</strong> {{ property.RegisterDatePersian }}</div>
        </div>
    </div>

    <!-- Ø§Ù…Ú©Ø§Ù†Ø§Øª -->
    {% if property.amenities %}
    <div class="section">
        <div class="section-title">âœ¨ Ø§Ù…Ú©Ø§Ù†Ø§Øª</div>
        <div class="amenities-list">
            {% for amenity in property.amenities.split(',') %}
            <span class="amenity-tag">{{ amenity.strip() }}</span>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- ØªÙˆØ¶ÛŒØ­Ø§Øª -->
    {% if property.description %}
    <div class="section">
        <div class="section-title">ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª</div>
        <p style="line-height: 1.8; color: #555;">{{ property.description }}</p>
    </div>
    {% endif %}

    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„Ú© -->
    {% if owner %}
    <div class="section">
        <div class="section-title">ğŸ‘¤ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø§Ù„Ú©</div>
        <div class="info-grid">
            <div class="info-item"><strong>Ù†Ø§Ù…:</strong> {{ owner.name }}</div>
            <div class="info-item"><strong>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</strong> {{ owner.Family }}</div>
            <div class="info-item"><strong>ØªÙ„ÙÙ†:</strong> {{ owner.phone }}</div>
            <div class="info-item"><strong>Ù†ØªÛŒØ¬Ù‡ Ø¢Ø²Ù…ÙˆÙ† DISC:</strong> {{ owner.DISC_test or "â€”" }}</div>
        </div>
    </div>
    {% endif %}

    <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø´Ø§ÙˆØ± -->
    {% if advisor %}
    <div class="section">
        <div class="section-title">ğŸ§‘â€ğŸ’¼ Ù…Ø´Ø§ÙˆØ± Ø«Ø¨Øª Ú©Ù†Ù†Ø¯Ù‡</div>
        <div class="info-grid">
            <div class="info-item"><strong>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</strong> {{ advisor.username }}</div>
            <div class="info-item"><strong>Ù†Ø§Ù…:</strong> {{ advisor.first_name or "â€”" }}</div>
            <div class="info-item"><strong>Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</strong> {{ advisor.last_name or "â€”" }}</div>
            <div class="info-item"><strong>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³:</strong> {{ advisor.phone or "â€”" }}</div>
            <div class="info-item"><strong>Ù†Ù‚Ø´:</strong> {{ "Ø§Ø¯Ù…ÛŒÙ†" if advisor.role == "admin" else "Ù…Ø´Ø§ÙˆØ±" }}</div>
        </div>
    </div>
    {% endif %}

    <!-- Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª -->
    <a href="/admin/properties" class="back-btn">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª Ù…Ù„Ú©â€ŒÙ‡Ø§</a>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const lat = parseFloat("{{ property.latitude }}");
    const lng = parseFloat("{{ property.longitude }}");

    if (isNaN(lat) || isNaN(lng)) {
        console.error("Invalid coordinates");
        const map = L.map('map').setView([29.4549, 60.8845], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        L.marker([29.4549, 60.8845]).addTo(map).bindPopup("Ù…ÙˆÙ‚Ø¹ÛŒØª Ù†Ø§Ù…Ø´Ø®Øµ");
    } else {
        const map = L.map('map').setView([lat, lng], 16);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        L.marker([lat, lng]).addTo(map).bindPopup(`
            <b>{{ property.title|e }}</b><br>
            {{ property.detailed_address|e }}<br>
            <small>Ø¹Ø±Ø¶: ${lat}<br>Ø·ÙˆÙ„: ${lng}</small>
        `).openPopup();
    }
</script>

</body>
</html>